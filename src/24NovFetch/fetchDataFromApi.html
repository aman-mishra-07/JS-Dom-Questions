<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch data</title>
    <link rel="stylesheet" href="/dist/output.css">
</head>

<body>
    <div class="p-10 space-y-4 min-h-screen">
        <h1 class="text-2xl font-semibold">Products</h1>
        <ul data-productList class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
        </ul>
    </div>

    <script>
        (async () => {
            'use strict'

            const productsUrl = 'https://fakestoreapi.com/products';

            const getData = async (url) => {
                const response = await fetch(url)
                if (response.status === 200) {
                    return response.json();
                }
            }


            let controller = new AbortController();

            // post data function
            const postData = async (url, item) => {
                let response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json;charset=utf-8'
                    },
                    body: JSON.stringify(item),
                    signal: controller.signal,
                });
                return await response.json();
            }

            // Abort Controller
            setTimeout(() => {
                controller.abort()
            }, 5000)

            const products = await getData(productsUrl);
            await localStorage.setItem('products', JSON.stringify(products));


            const newProduct = {
                title: "Leather Backpack, Fits 15 Laptops",
                price: 200,
                description: "Your perfect pack for everyday use and walks in the forest. Stash your laptop (up to 15 inches) in the padded sleeve, your everyday",
                category: "men's clothing new",
                image: "https://fakestoreapi.com/img/81fPKd-2AYL._AC_SL1500_.jpg",
                rating: {
                    rate: 4,
                    count: 140
                }
            }



            let newProdRes = await postData(productsUrl, newProduct);
            await products.push(await newProdRes);
            // await localStorage.setItem('products', JSON.stringify(products));

            async function listProducts(products) {
                let list = document.querySelector('[data-productList]')
                let listProducts = ''
                await products.forEach(element => {
                    let prod = ` 
                    <li class="w-full max-w-sm border flex gap-4 p-2 rounded shadow" >
                        <div class="shrink-0">
                            <img src="${element.image}" alt="" class="w-24 h-24 object-cover">
                        </div>
                        <div>
                            <h2 class="text-md font-medium">${element.title}</h2>
                            <p>Price : ${element.price}</p>
                            <p>category : ${element.category}</p>
                        </div>
                    </li>`
                    listProducts += prod;
                });
                list.innerHTML = listProducts;
            }
            listProducts(products)

        })()
    </script>
</body>

</html>