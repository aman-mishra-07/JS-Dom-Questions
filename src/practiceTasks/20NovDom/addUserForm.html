<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New User</title>
    <link rel="stylesheet" href="/dist/output.css">
</head>

<body>
    <div class="relative min-h-screen w-full bg-blue-500 flex items-center justify-center p-10" data-NewUserForm>
        <div class="w-full max-w-3xl bg-white p-10 rounded-md shadow">
            <a href="/src/20NovDom/AdminPanel.html" class="text-sm font-semibold flex items-center gap-2">
                <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <polygon
                        points="3.828 9 9.899 2.929 8.485 1.515 0 10 .707 10.707 8.485 18.485 9.899 17.071 3.828 11 20 11 20 9 3.828 9">
                    </polygon>
                </svg>
                <span>Go Back To Admin Panel</span>
            </a>
            <form id="addUserForm" method="post" action="" class="space-y-4">
                <h1 class="font-semibold text-3xl text-center" data-formHeading>Register New User</h1>
                <div class="grid grid-cols-2 gap-8 items-center">
                    <div>
                        <label for="firstName" class="block">First Name</label>
                        <input type="text" name="firstName" id="firstName" class="border p-2 rounded-md w-full">
                        <p data-fnameError class="text-red-600"></p>
                    </div>

                    <div>
                        <label for="lastName" class="block">Last Name</label>
                        <input type="text" name="lastName" id="LastName" class="border p-2 rounded-md w-full">
                        <p data-lastNameError class="text-red-600 "></p>
                    </div>

                    <div>
                        <label for="age" class="block">Age</label>
                        <input type="number" name="age" id="age" class="border p-2 rounded-md w-full hidden-spinner">
                        <p data-ageError class="text-red-600 "></p>
                    </div>

                    <fieldset class="">
                        <legend class="">Gender</legend>
                        <div class="space-x-2 flex">
                            <input type="radio" name="gender" id="male" value="male"><label for="male">Male</label>
                            <input type="radio" name="gender" id="female" value="female"><label
                                for="female">Female</label>
                            <input type="radio" name="gender" value="transgender" id="transgender"><label
                                for="transgender">Transgender</label>
                            <input type="radio" name="gender" value="others" id="others"><label
                                for="others">Others</label>
                        </div>
                        <p data-genderError class="text-red-600"></p>
                    </fieldset>

                    <div>
                        <label for="DOB">Date Of Birth</label>
                        <input type="date" name="dob" id="DOB" class="border p-2 rounded-md w-full">
                        <p data-dobError class="text-red-600"></p>
                    </div>

                    <div>
                        <label for="email">Email</label>
                        <input type="email" name="email" id="email" class="border p-2 rounded-md w-full">
                        <p data-emailError class="text-red-600"></p>
                    </div>

                    <div>
                        <label for="BloodGroup">Blood Group</label>
                        <input type="text" name="bloodGroup" id="BloodGroup" class="border p-2 rounded-md w-full"
                            placeholder="example(A+)">
                        <p data-bloodGroupError class="text-red-600"></p>
                    </div>

                    <div>
                        <label for="jobRole">Role</label>
                        <select name="jobRole" id="jobRole" class="border p-2 rounded-md w-full">
                            <option value="">Select Role</option>
                            <option value="admin">Admin</option>
                            <option value="employee">Employee</option>
                            <option value="hr">HR</option>
                        </select>
                        <p data-jobRoleError class="text-red-600"></p>
                    </div>

                    <div class="flex gap-2 items-center col-span-2">
                        <div class="h-14 aspect-square border shrink-0 rounded-full overflow-hidden">
                            <img src="https://images.rawpixel.com/image_png_social_square/cHJpdmF0ZS9sci9pbWFnZXMvd2Vic2l0ZS8yMDIzLTAxL3JtNjA5LXNvbGlkaWNvbi13LTAwMi1wLnBuZw.png"
                                alt="user" class="w-full h-full object-cover" data-imageBox>
                        </div>
                        <label for="image">Photograph</label>
                        <input type="file" name="image" accept="image/png, image/jpeg, image/jpg"
                            class="border p-2 rounded-md w-full">
                        <p data-photographError class="text-red-600"> </p>
                    </div>

                    <div class="col-span-2">
                        <label for="currentAddress">Current Address</label>
                        <textarea name="currentAddress" id="currentAddress"
                            class="border resize-none p-2 rounded-md w-full "></textarea>
                        <p data-currentAddressError class="text-red-600"></p>
                        <div class="space-x-2">
                            <input type="checkbox" id="sameAddress">
                            <label for="sameAddress">Same Permanent address as Current
                                Address</label>
                        </div>
                    </div>

                    <div class="col-span-2">
                        <label for="permanentAddress">Permanent Address</label>
                        <textarea name="permanentAddress" id="permanentAddress"
                            class="border resize-none p-2 rounded-md w-full"></textarea>
                        <p data-permanentAddressError class="text-red-600"></p>
                    </div>

                    <button type="submit"
                        class="bg-blue-500 text-white font-semibold p-2 rounded-md col-span-2">Submit</button>
                </div>
        </div>
        </form>
        <div data-modal class="fixed inset-0 bg-black bg-opacity-20 hidden items-center justify-center">
            <div class="p-10 w-full max-w-lg bg-green-600 rounded-md space-y-4">
                <h2 class="font-bold text-2xl text-white flex items-center justify-between">
                    <span data-successMsg>New User Added SuccessFully </span>
                    <svg class="w-8 h-8" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                        <path
                            d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z">
                        </path>
                    </svg>
                </h2>

                <a href="/src/20NovDom/AdminPanel.html"
                    class="w-full block text-center bg-white hover:bg-opacity-90 font-semibold rounded-md px-4 py-1">Ok,
                    Go to
                    AdminPanel</a>
            </div>
        </div>
    </div>
    </div>
    <script>
        (function () {
            'use strict'

            const user = {
                Users: localStorage.getItem('users') ? JSON.parse(localStorage.getItem('users')) : [],
                userform: document.querySelector('#addUserForm'),

                updateLocalStorage: function () {
                    localStorage.setItem('users', JSON.stringify(this.Users));
                },

                imageInput: document.querySelector('input[type= "file"]'),
                imageUrl: '',
                modal: document.querySelector('[data-modal]'),
                firstName: document.querySelector('input[name="firstName"]'),
                lastName: document.querySelector('input[name="lastName"]'),
                age: document.querySelector('input[name="age"]'),
                dob: document.querySelector('input[name = "dob"]'),
                jobRole: document.querySelector('select[name = "jobRole"]'),
                email: document.querySelector('input[name="email"]'),
                currentAddress: document.querySelector('textarea[name = "currentAddress"]'),
                permanentAddress: document.querySelector('textarea[name = "permanentAddress"]'),
                bloodGroup: document.querySelector('input[name = "bloodGroup"]'),
                gender: document.querySelector('input[name = "gender"]'),
                sameAddress: document.querySelector('#sameAddress'),
                imageBox: document.querySelector('[data-imageBox]'),
                formHeading: document.querySelector('[data-formHeading]'),
                successMsg: document.querySelector('[data-successMsg]'),

        
                setError: {
                    showError: function (elemId, err) {
                        elemId.innerHTML = err;
                    },
                    errorBox: {
                        fnameError: document.querySelector('[data-fnameError]'),
                        lastNameError: document.querySelector('[data-lastNameError]'),
                        ageError: document.querySelector('[data-ageError]'),
                        genderError: document.querySelector('[data-genderError]'),
                        dobError: document.querySelector('[data-dobError]'),
                        bloodGroupError: document.querySelector('[data-bloodGroupError]'),
                        emailError: document.querySelector('[data-emailError]'),
                        jobRoleError: document.querySelector('[data-jobRoleError]'),
                        photographError: document.querySelector('[data-photographError]'),
                        currentAddressError: document.querySelector('[data-currentAddressError]'),
                        permanentAddressError: document.querySelector('[data-permanentAddressError]'),
                    },
                },
                changeUser: {},
                editUser: function () {
                    if (localStorage.getItem('editUser')) {
                        this.formHeading.innerHTML = 'Edit Profile';
                        this.successMsg.innerHTML = 'Profile Updated'
                        let editUserId = JSON.parse(localStorage.getItem('editUser'))
                        let editUserData = this.Users.filter((item) => item.id === +editUserId[0]?.id)
                        let itemIndex = this.Users.indexOf(editUserData[0])

                        this.changeUser = this.Users[itemIndex];

                        this.firstName.value = this.Users[itemIndex]?.firstName
                        this.lastName.value = this.Users[itemIndex]?.lastName
                        this.age.value = this.Users[itemIndex]?.age
                        this.email.value = this.Users[itemIndex]?.email
                        this.gender.checked = this.Users[itemIndex]?.gender
                        this.dob.value = this.Users[itemIndex]?.dob
                        this.bloodGroup.value = this.Users[itemIndex]?.bloodGroup
                        this.jobRole.value = this.Users[itemIndex]?.jobRole
                        this.currentAddress.innerText = this.Users[itemIndex]?.currentAddress
                        this.permanentAddress.innerText = this.Users[itemIndex]?.permanentAddress
                        this.imageBox.src = this.Users[itemIndex]?.image ? this.Users[itemIndex]?.image : `https://images.rawpixel.com/image_png_social_square/cHJpdmF0ZS9sci9pbWFnZXMvd2Vic2l0ZS8yMDIzLTAxL3JtNjA5LXNvbGlkaWNvbi13LTAwMi1wLnBuZw.png`
                        localStorage.removeItem('editUser');
                    }
                    return
                },
                validate: {
                    checkName: function (name) {
                        return (/^[A-Za-z]+$/.test(name.trim())) ? true : false;
                    },
                    checkEmail: function (mail) {
                        return (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail)) ? true : false;
                    },
                    checkBloodGroup: function (bloodGroup) {
                        return (/^(A|B|AB|O)[+-]$/.test(bloodGroup)) ? true : false;
                    },
                    checkDate: function (date) {
                        return (date > Date.now()) ? true : false
                    },
                    checkAge: function (age) {
                        return (age > 0) ? true : false;
                    }

                },
                createNewUser: function () {
                    if (this.changeUser == '') {
                        let newUser = new FormData(this.userform)
                        let user = {};
                        newUser.forEach((value, key) => {
                            if ((key === 'firstName' && this.validate.checkName(this.firstName.value.trim()))
                                || (key === 'lastName' && this.validate.checkName(this.lastName.value.trim()))
                                || (key === 'age' && this.validate.checkAge(this.age.value.trim()))
                                || (key === 'email' && this.validate.checkEmail(this.email.value.trim()))
                                || (key === 'dob' && this.dob.value != '')
                                || (key == 'gender')
                                || (key == 'bloodGroup' && this.validate.checkBloodGroup(this.bloodGroup.value.trim()))
                                || (key == 'jobRole' && this.jobRole.value != '')
                                || (key == 'currentAddress' && this.currentAddress.value.trim() != '')
                                || (key == 'permanentAddress' && this.permanentAddress.value.trim() != '')
                            ) {
                                user[key] = value;
                                newUserLength++
                            }
                            if (key == 'image' && this.imageUrl != '') {
                                user[key] = this.imageUrl
                                newUserLength++
                            }
                        })
                        if (Object.entries(user).length == 11) {
                            user.id = Date.now()
                            this.Users.push(user);
                            this.modal.classList.remove('hidden')
                            this.modal.classList.add('flex')
                            this.updateLocalStorage();
                        } else {
                            alert('Please fill all fields')
                        }
                    }
                    else {
                        let itemAt = this.Users.indexOf(this.changeUser);
                        if (itemAt !== -1) {
                            this.Users[itemAt].firstName = this.firstName.value;
                            this.Users[itemAt].lastName = this.lastName.value;
                            this.Users[itemAt].age = this.age.value;
                            this.Users[itemAt].gender = this.gender.value;
                            this.Users[itemAt].dob = this.dob.value;
                            this.Users[itemAt].email = this.email.value;
                            this.Users[itemAt].bloodGroup = this.bloodGroup.value;
                            this.Users[itemAt].jobRole = this.jobRole.value;
                            this.Users[itemAt].currentAddress = this.currentAddress.value;
                            this.Users[itemAt].permanentAddress = this.permanentAddress.value;
                            if (this.imageUrl !== '') {
                                this.Users[itemAt].image = this.imageUrl;
                            }
                            this.modal.classList.remove('hidden')
                            this.modal.classList.add('flex')
                            this.updateLocalStorage();
                            this.userform.reset();
                        }
                    }
                },
                bind: function () {
                    this.editUser();
                    this.firstName.addEventListener('blur', (e) => {
                        if (!this.validate.checkName(this.firstName.value.trim())) {
                            this.setError.showError(this.setError.errorBox.fnameError, '*special characters not allowed')
                            return
                        }
                        this.setError.showError(this.setError.errorBox.fnameError, '')
                    })
                    this.lastName.addEventListener('blur', (e) => {
                        if (!this.validate.checkName(this.lastName.value.trim())) {
                            this.setError.showError(this.setError.errorBox.lastNameError, 'special characters not allowed')
                            return;
                        }
                        this.setError.showError(this.setError.errorBox.lastNameError, '')
                    })
                    this.bloodGroup.addEventListener('blur', (e) => {
                        if (!this.validate.checkBloodGroup(this.bloodGroup.value)) {
                            this.setError.showError(this.setError.errorBox.bloodGroupError, 'enter valid blood group')
                            return
                        }
                        this.setError.showError(this.setError.errorBox.bloodGroupError, '')
                    })
                    this.dob.addEventListener('blur', e => {

                        if (!this.validate.checkDate(this.dob.value)) {
                            this.setError.showError(this.setError.errorBox.dobError, '*enter correct date')
                        }
                        this.setError.showError(this.setError.errorBox.dobError, '')
                    })
                    this.email.addEventListener('blur', (e) => {
                        if (!this.validate.checkEmail(this.email.value.trim())) {
                            this.setError.showError(this.setError.errorBox.emailError, '*enter correct email')
                            return;
                        }
                        this.setError.showError(this.setError.errorBox.emailError, '')
                    })
                    this.age.addEventListener('blur', (e) => {
                        if (!this.validate.checkAge(this.age.value.trim())) {
                            this.setError.showError(this.setError.errorBox.ageError, '*invalid Age')
                            return;
                        }
                        this.setError.showError(this.setError.errorBox.ageError, '')

                    })
                    this.sameAddress.addEventListener('click', (e) => {
                        if (this.sameAddress.checked == true) {
                            this.permanentAddress.innerHTML = this.currentAddress.value;
                            return;
                        }
                        this.permanentAddress.innerHTML = '';
                    })
                    this.imageInput.addEventListener('change', (e) => {
                        let selectedfile = new FileReader();
                        selectedfile.readAsDataURL(this.imageInput.files[0])

                        selectedfile.addEventListener('load', () => {
                            this.imageUrl = selectedfile.result
                            this.imageBox.src = selectedfile.result
                        })
                    })
                    this.userform.addEventListener('submit', (e) => {
                        e.preventDefault()
                        this.createNewUser();
                    })
                },
                render: function () {
                    this.bind();
                }
            }
            user.render()
        })()

    </script>
</body>

</html>